!function(w,a){function E(e){return 0<e&&0==(e-1&e)}var r=[1,0,0,0,1,0,0,0,1],i=function(e,t){var r=e[0],i=e[1],a=e[2],o=e[3],n=e[4],f=e[5],s=e[6],l=e[7],c=e[8],u=t[0],h=t[1],d=t[2],p=t[3],g=t[4],m=t[5],v=t[6],b=t[7],x=t[8];t[0]=u*r+p*i+v*a,t[1]=h*r+g*i+b*a,t[2]=d*r+m*i+x*a,t[3]=u*o+p*n+v*f,t[4]=h*o+g*n+b*f,t[5]=d*o+m*n+x*f,t[6]=u*s+p*l+v*c,t[7]=h*s+g*l+b*c,t[8]=d*s+m*l+x*c};function t(e){return this.clearStack(e)}t.prototype.clearStack=function(e){this.m_stack=[],this.m_cache=[],this.c_stack=0,this.valid=0,this.result=null;for(var t=0;t<16;t++)this.m_stack[t]=this.getIdentity();e!==a?this.m_stack[0]=e:this.setIdentity()},t.prototype.setIdentity=function(){this.m_stack[this.c_stack]=this.getIdentity(),this.valid===this.c_stack&&this.c_stack&&this.valid--},t.prototype.getIdentity=function(){return[1,0,0,0,1,0,0,0,1]},t.prototype.getResult=function(){if(!this.c_stack)return this.m_stack[0];var e=r;this.valid>this.c_stack-1&&(this.valid=this.c_stack-1);for(var t=this.valid;t<this.c_stack+1;t++)e=i(this.m_stack[t],e),this.m_cache[t]=e;return this.valid=this.c_stack-1,this.result=this.m_cache[this.c_stack],this.result},t.prototype.pushMatrix=function(){this.c_stack++,this.m_stack[this.c_stack]=this.getIdentity()},t.prototype.popMatrix=function(){0!==this.c_stack&&this.c_stack--};var o=t.prototype.getIdentity();t.prototype.translate=function(e,t){o[6]=e,o[7]=t,i(o,this.m_stack[this.c_stack])};var n=t.prototype.getIdentity();t.prototype.scale=function(e,t){n[0]=e,n[4]=t,i(n,this.m_stack[this.c_stack])};var f=t.prototype.getIdentity();t.prototype.rotate=function(e){var t,r;t=w.sin(-e),r=w.cos(-e),f[0]=r,f[3]=t,f[1]=-t,f[4]=r,i(f,this.m_stack[this.c_stack])};var s=window.WebGL2D=function(r,e){var i;this.canvas=r,this.options=e||{},this.gl=a,this.fs=a,this.vs=a,this.shaderProgram=a,this.transform=new t,this.shaderPool=[],this.maxTextureSize=a,r.gl2d=this,r.$getContext=r.getContext,r.getContext=(i=this,function(e){if(!i.options.force&&"webgl-2d"!==e||0===r.width||0===r.height)return i.canvas.$getContext(e);if(i.gl)return i.gl;var t=i.gl=i.canvas.$getContext("experimental-webgl");return null==t?i.canvas.$getContext("2d"):(i.initShaders(),i.initBuffers(),i.initCanvas2DAPI(),t.enable(t.BLEND),t.blendFuncSeparate(t.SRC_ALPHA,t.ONE_MINUS_SRC_ALPHA,t.ONE,t.ONE_MINUS_SRC_ALPHA),i.maxTextureSize=t.getParameter(t.MAX_TEXTURE_SIZE),t)}),this.postInit()};s.enable=function(e,t){return e.gl2d||new s(e,t)};var k=1,R=2;s.prototype.getFragmentShaderSource=function(e){return["#ifdef GL_ES","precision highp float;","#endif","#define hasTexture "+(e==k?"1":"0"),"#define hasCrop "+(e==R?"1":"0"),"varying vec4 vColor;","#if hasTexture","varying vec2 vTextureCoord;","uniform sampler2D uSampler;","#if hasCrop","uniform vec4 uCropSource;","#endif","#endif","void main(void) {","#if hasTexture","#if hasCrop","gl_FragColor = texture2D(uSampler, vec2(vTextureCoord.x * uCropSource.z, vTextureCoord.y * uCropSource.w) + uCropSource.xy);","#else","gl_FragColor = texture2D(uSampler, vTextureCoord);","#endif","#else","gl_FragColor = vColor;","#endif","}"].join("\n")},s.prototype.getVertexShaderSource=function(e,t){return["#define hasTexture "+(t==k?"1":"0"),"attribute vec4 aVertexPosition;","#if hasTexture","varying vec2 vTextureCoord;","#endif","uniform vec4 uColor;","uniform mat3 uTransforms["+(e=e||1)+"];","varying vec4 vColor;","uniform mat4 pMatrix;","mat3 crunchStack(void) {","mat3 result = uTransforms[0];","for (int i = 1; i < "+e+"; ++i) {","result = uTransforms[i] * result;","}","return result;","}","void main(void) {","vec3 position = crunchStack() * vec3(aVertexPosition.x, aVertexPosition.y, 1.0);","gl_Position = pMatrix * vec4(position, 1.0);","vColor = uColor;","#if hasTexture","vTextureCoord = aVertexPosition.zw;","#endif","}"].join("\n")},s.prototype.initShaders=function(e,t){var r=this.gl;e=e||1,t=t||0;var i=this.shaderPool[e];if(i||(i=this.shaderPool[e]=[]),i=i[t])r.useProgram(i),this.shaderProgram=i;else{var a=this.fs=r.createShader(r.FRAGMENT_SHADER);if(r.shaderSource(this.fs,this.getFragmentShaderSource(t)),r.compileShader(this.fs),!r.getShaderParameter(this.fs,r.COMPILE_STATUS))throw"fragment shader error: "+r.getShaderInfoLog(this.fs);var o=this.vs=r.createShader(r.VERTEX_SHADER);if(r.shaderSource(this.vs,this.getVertexShaderSource(e,t)),r.compileShader(this.vs),!r.getShaderParameter(this.vs,r.COMPILE_STATUS))throw"vertex shader error: "+r.getShaderInfoLog(this.vs);var n=this.shaderProgram=r.createProgram();if(n.stackDepth=e,r.attachShader(n,a),r.attachShader(n,o),r.linkProgram(n),!r.getProgramParameter(n,r.LINK_STATUS))throw"Could not initialise shaders.";r.useProgram(n),n.vertexPositionAttribute=r.getAttribLocation(n,"aVertexPosition"),r.enableVertexAttribArray(n.vertexPositionAttribute),n.uColor=r.getUniformLocation(n,"uColor"),n.uSampler=r.getUniformLocation(n,"uSampler"),n.uCropSource=r.getUniformLocation(n,"uCropSource"),n.pMatrix=r.getUniformLocation(n,"pMatrix"),n.uTransforms=[];for(var f=0;f<e;++f)n.uTransforms[f]=r.getUniformLocation(n,"uTransforms["+f+"]");this.shaderPool[e][t]=n}return c[0]=2/this.canvas.width,c[5]=-2/this.canvas.height,r.uniformMatrix4fv(this.shaderProgram.pMatrix,!1,c),r.viewport(0,0,this.canvas.width,this.canvas.height),this.shaderProgram};var l=new Float32Array([0,0,0,0,0,1,0,1,1,1,1,1,1,0,1,0]),c=new Float32Array(16);c[10]=1,c[11]=1,c[12]=-1,c[13]=1,s.prototype.initBuffers=function(){var e=this.gl;e.rectVertexPositionBuffer=e.createBuffer(),e.rectVertexColorBuffer=e.createBuffer(),e.pathVertexPositionBuffer=e.createBuffer(),e.pathVertexColorBuffer=e.createBuffer(),e.bindBuffer(e.ARRAY_BUFFER,e.rectVertexPositionBuffer),e.bufferData(e.ARRAY_BUFFER,l,e.STATIC_DRAW)},s.instances=[],s.prototype.postInit=function(){s.instances.push(this)},s.prototype.initCanvas2DAPI=function(){var p=this,g=this.gl,e=document.createElement("canvas");e.width=p.canvas.width,e.height=p.canvas.height;var t=e.getContext("2d"),c=/^rgb(a)?\(\s*(-?[\d]+)(%)?\s*,\s*(-?[\d]+)(%)?\s*,\s*(-?[\d]+)(%)?\s*,?\s*(-?[\d\.]+)?\s*\)$/,u=/^hsl(a)?\(\s*(-?[\d\.]+)\s*,\s*(-?[\d\.]+)%\s*,\s*(-?[\d\.]+)%\s*,?\s*(-?[\d\.]+)?\s*\)$/,h=/^#([0-9A-Fa-f]{6})$/,d=/^#([0-9A-Fa-f])([0-9A-Fa-f])([0-9A-Fa-f])$/;function m(e){var t,r,i,a,o,n,f=[];if(t=c.exec(e)){if(a=t[1],o=parseFloat(t[8]),a&&isNaN(o)||!a&&!isNaN(o))return!1;n=t[3];for(var s=2;s<8;s+=2){if(r=t[s],(i=t[s+1])!==n)return!1;r=i?(r=100<r?1:r/100)<0?0:r:(r=255<r?1:r/255)<0?0:r,f.push(r)}f.push(a?o:1)}else if(t=u.exec(e))a=t[1],o=parseFloat(t[5]),f=function(e,t,r,i){var a,o,n,f,s;if(e=(e%360+360)%360/360,r=(r=100<r?1:r/100)<0?0:r,0==(t=(t=100<t?1:t/100)<0?0:t))a=o=n=r;else{function l(e,t,r){return r<0&&(r+=1),1<r&&(r-=1),r<1/6?e+6*(t-e)*r:r<.5?t:r<2/3?e+(t-e)*(2/3-r)*6:e}a=l(f=2*r-(s=r<.5?r*(1+t):r+t-r*t),s,e+1/3),o=l(f,s,e),n=l(f,s,e-1/3)}return[a,o,n,i]}(t[2],t[3],t[4],parseFloat(a&&o?o:1));else if(t=h.exec(e)){var l=parseInt(t[1],16);f=[((16711680&l)>>16)/255,((65280&l)>>8)/255,(255&l)/255,1]}else if(t=d.exec(e)){f=m("#"+[t[1],t[1],t[2],t[2],t[3],t[3]].join(""))}else if(e.toLowerCase()in v)f=m(v[e.toLowerCase()]);else{if("transparent"!==e.toLowerCase())return!1;f=[0,0,0,0]}return f}function r(e){return"rgba("+255*e[0]+", "+255*e[1]+", "+255*e[2]+", "+parseFloat(e[3])+")"}var v={aliceblue:"#f0f8ff",antiquewhite:"#faebd7",aqua:"#00ffff",aquamarine:"#7fffd4",azure:"#f0ffff",beige:"#f5f5dc",bisque:"#ffe4c4",black:"#000000",blanchedalmond:"#ffebcd",blue:"#0000ff",blueviolet:"#8a2be2",brown:"#a52a2a",burlywood:"#deb887",cadetblue:"#5f9ea0",chartreuse:"#7fff00",chocolate:"#d2691e",coral:"#ff7f50",cornflowerblue:"#6495ed",cornsilk:"#fff8dc",crimson:"#dc143c",cyan:"#00ffff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkgray:"#a9a9a9",darkgreen:"#006400",darkkhaki:"#bdb76b",darkmagenta:"#8b008b",darkolivegreen:"#556b2f",darkorange:"#ff8c00",darkorchid:"#9932cc",darkred:"#8b0000",darksalmon:"#e9967a",darkseagreen:"#8fbc8f",darkslateblue:"#483d8b",darkslategray:"#2f4f4f",darkturquoise:"#00ced1",darkviolet:"#9400d3",deeppink:"#ff1493",deepskyblue:"#00bfff",dimgray:"#696969",dodgerblue:"#1e90ff",firebrick:"#b22222",floralwhite:"#fffaf0",forestgreen:"#228b22",fuchsia:"#ff00ff",gainsboro:"#dcdcdc",ghostwhite:"#f8f8ff",gold:"#ffd700",goldenrod:"#daa520",gray:"#808080",green:"#008000",greenyellow:"#adff2f",grey:"#808080",honeydew:"#f0fff0",hotpink:"#ff69b4",indianred:"#cd5c5c",indigo:"#4b0082",ivory:"#fffff0",khaki:"#f0e68c",lavender:"#e6e6fa",lavenderblush:"#fff0f5",lawngreen:"#7cfc00",lemonchiffon:"#fffacd",lightblue:"#add8e6",lightcoral:"#f08080",lightcyan:"#e0ffff",lightgoldenrodyellow:"#fafad2",lightgrey:"#d3d3d3",lightgreen:"#90ee90",lightpink:"#ffb6c1",lightsalmon:"#ffa07a",lightseagreen:"#20b2aa",lightskyblue:"#87cefa",lightslategray:"#778899",lightsteelblue:"#b0c4de",lightyellow:"#ffffe0",lime:"#00ff00",limegreen:"#32cd32",linen:"#faf0e6",magenta:"#ff00ff",maroon:"#800000",mediumaquamarine:"#66cdaa",mediumblue:"#0000cd",mediumorchid:"#ba55d3",mediumpurple:"#9370d8",mediumseagreen:"#3cb371",mediumslateblue:"#7b68ee",mediumspringgreen:"#00fa9a",mediumturquoise:"#48d1cc",mediumvioletred:"#c71585",midnightblue:"#191970",mintcream:"#f5fffa",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",navajowhite:"#ffdead",navy:"#000080",oldlace:"#fdf5e6",olive:"#808000",olivedrab:"#6b8e23",orange:"#ffa500",orangered:"#ff4500",orchid:"#da70d6",palegoldenrod:"#eee8aa",palegreen:"#98fb98",paleturquoise:"#afeeee",palevioletred:"#d87093",papayawhip:"#ffefd5",peachpuff:"#ffdab9",peru:"#cd853f",pink:"#ffc0cb",plum:"#dda0dd",powderblue:"#b0e0e6",purple:"#800080",red:"#ff0000",rosybrown:"#bc8f8f",royalblue:"#4169e1",saddlebrown:"#8b4513",salmon:"#fa8072",sandybrown:"#f4a460",seagreen:"#2e8b57",seashell:"#fff5ee",sienna:"#a0522d",silver:"#c0c0c0",skyblue:"#87ceeb",slateblue:"#6a5acd",slategray:"#708090",snow:"#fffafa",springgreen:"#00ff7f",steelblue:"#4682b4",tan:"#d2b48c",teal:"#008080",thistle:"#d8bfd8",tomato:"#ff6347",turquoise:"#40e0d0",violet:"#ee82ee",wheat:"#f5deb3",white:"#ffffff",whitesmoke:"#f5f5f5",yellow:"#ffff00",yellowgreen:"#9acd32"},b={},i=[];b.fillStyle=[0,0,0,1],Object.defineProperty(g,"fillStyle",{get:function(){return r(b.fillStyle)},set:function(e){b.fillStyle=e instanceof l?e:m(e)||b.fillStyle}}),b.strokeStyle=[0,0,0,1],Object.defineProperty(g,"strokeStyle",{get:function(){return r(b.strokeStyle)},set:function(e){b.strokeStyle=m(e)||drawStyle.strokeStyle}}),g.$lineWidth=g.lineWidth,b.lineWidth=1,Object.defineProperty(g,"lineWidth",{get:function(){return b.lineWidth},set:function(e){g.$lineWidth(e),b.lineWidth=e}}),b.lineCap="butt",Object.defineProperty(g,"lineCap",{get:function(){return b.lineCap},set:function(e){b.lineCap=e}}),b.lineJoin="miter",Object.defineProperty(g,"lineJoin",{get:function(){return b.lineJoin},set:function(e){b.lineJoin=e}}),b.miterLimit=10,Object.defineProperty(g,"miterLimit",{get:function(){return b.miterLimit},set:function(e){b.miterLimit=e}}),b.shadowOffsetX=0,Object.defineProperty(g,"shadowOffsetX",{get:function(){return b.shadowOffsetX},set:function(e){b.shadowOffsetX=e}}),b.shadowOffsetY=0,Object.defineProperty(g,"shadowOffsetY",{get:function(){return b.shadowOffsetY},set:function(e){b.shadowOffsetY=e}}),b.shadowBlur=0,Object.defineProperty(g,"shadowBlur",{get:function(){return b.shadowBlur},set:function(e){b.shadowBlur=e}}),b.shadowColor="rgba(0, 0, 0, 0.0)",Object.defineProperty(g,"shadowColor",{get:function(){return b.shadowColor},set:function(e){b.shadowColor=e}}),b.font="10px sans-serif",Object.defineProperty(g,"font",{get:function(){return b.font},set:function(e){t.font=e,b.font=e}}),b.textAlign="start",Object.defineProperty(g,"textAlign",{get:function(){return b.textAlign},set:function(e){b.textAlign=e}}),b.textBaseline="alphabetic",Object.defineProperty(g,"textBaseline",{get:function(){return b.textBaseline},set:function(e){b.textBaseline=e}}),b.globalAlpha=1,Object.defineProperty(g,"globalAlpha",{get:function(){return b.globalAlpha},set:function(e){b.globalAlpha=e}}),b.globalCompositeOperation="source-over",Object.defineProperty(g,"globalCompositeOperation",{get:function(){return b.globalCompositeOperation},set:function(e){b.globalCompositeOperation=e}}),g.fillText=function(e,t,r){},g.strokeText=function(){},g.measureText=function(){return 1};var T=document.createElement("canvas").getContext("2d");function A(e){for(var t=p.transform.m_stack,r=0,i=p.transform.c_stack+1;r<i;++r)g.uniformMatrix3fv(e.uTransforms[r],!1,t[i-1-r])}function S(e,t){return x2=e+1,y2=t+1,[e,t,e,t,e,y2,e,y2,x2,y2,x2,y2,x2,t,x2,t]}g.save=function(){p.transform.pushMatrix(),function(){var e={fillStyle:[b.fillStyle[0],b.fillStyle[1],b.fillStyle[2],b.fillStyle[3]],strokeStyle:[b.strokeStyle[0],b.strokeStyle[1],b.strokeStyle[2],b.strokeStyle[3]],globalAlpha:b.globalAlpha,globalCompositeOperation:b.globalCompositeOperation,lineCap:b.lineCap,lineJoin:b.lineJoin,lineWidth:b.lineWidth,miterLimit:b.miterLimit,shadowColor:b.shadowColor,shadowBlur:b.shadowBlur,shadowOffsetX:b.shadowOffsetX,shadowOffsetY:b.shadowOffsetY,textAlign:b.textAlign,font:b.font,textBaseline:b.textBaseline};i.push(e)}()},g.restore=function(){p.transform.popMatrix(),i.length&&(b=i.pop())},g.translate=function(e,t){p.transform.translate(e,t)},g.rotate=function(e){p.transform.rotate(e)},g.scale=function(e,t){p.transform.scale(e,t)},g.createImageData=function(e,t){return T.createImageData(e,t)},g.getImageData=function(e,t,r,i){var a=T.createImageData(r,i),o=new Uint8Array(r*i*4);g.readPixels(e,t,r,i,g.RGBA,g.UNSIGNED_BYTE,o);for(var n=4*r,f=i,s=0,l=f/2;s<l;++s)for(var c=0,u=n;c<u;++c){var h=s*n+c,d=(f-s-1)*n+c;a.data[h]=o[d],a.data[d]=o[h]}return a},g.putImageData=function(e,t,r){g.drawImage(e,t,r)},g.transform=function(e,t,r,i,a,o){var n=p.transform.m_stack[p.transform.c_stack];n[0]*=e,n[1]*=r,n[2]*=a,n[3]*=t,n[4]*=i,n[5]*=o,n[6]=0,n[7]=0},g.setTransform=function(e,t,r,i,a,o){p.transform.setIdentity(),g.transform.apply(this,arguments)},g.fillRect=function(e,t,r,i){b.fillStyle instanceof l?function(e,t,r,i){var a=p.transform,o=p.initShaders(a.c_stack,k),n=b.fillStyle.width,f=b.fillStyle.height;a.pushMatrix(),a.translate(0,0);var s=1;~["repeat","repeat-x"].indexOf(b.fillStyle.direction)&&(s=w.ceil((e+r)/n));var l=1;~["repeat","repeat-y"].indexOf(b.fillStyle.direction)&&(l=w.ceil((t+i)/f));var c=[];for(vX=0;vX<s;vX++)for(vY=0;vY<l;vY++)c=c.concat(S(vX,vY));g.bindBuffer(g.ARRAY_BUFFER,g.pathVertexPositionBuffer),g.bufferData(g.ARRAY_BUFFER,new Float32Array(c),g.STATIC_DRAW),g.vertexAttribPointer(o.vertexPositionAttribute,4,g.FLOAT,!1,0,0);var u=b.fillStyle.texture;a.scale(n,f),g.bindTexture(g.TEXTURE_2D,u.obj),g.texParameteri(g.TEXTURE_2D,g.TEXTURE_WRAP_S,g.REPEAT),g.texParameteri(g.TEXTURE_2D,g.TEXTURE_WRAP_T,g.REPEAT),g.activeTexture(g.TEXTURE0),g.uniform1i(o.uSampler,0),g.enable(g.SCISSOR_TEST);g.scissor(e,p.canvas.height-i-t,r,i),A(o),g.drawArrays(g.TRIANGLE_FAN,0,c.length/4),g.disable(g.SCISSOR_TEST),a.popMatrix()}.apply(this,arguments):function(e,t,r,i){var a=p.transform,o=p.initShaders(a.c_stack+2,0);a.pushMatrix(),a.translate(e,t),g.bindBuffer(g.ARRAY_BUFFER,g.rectVertexPositionBuffer),g.vertexAttribPointer(o.vertexPositionAttribute,4,g.FLOAT,!1,0,0);var n=b.fillStyle[0],f=b.fillStyle[1],s=b.fillStyle[2],l=b.fillStyle[3];a.scale(r,i),g.uniform4f(o.uColor,n,f,s,l),A(o),g.drawArrays(g.TRIANGLE_FAN,0,4),a.popMatrix()}.apply(this,arguments)},g.strokeRect=function(e,t,r,i){var a=p.transform,o=p.initShaders(a.c_stack+2,0);g.bindBuffer(g.ARRAY_BUFFER,g.rectVertexPositionBuffer),g.vertexAttribPointer(o.vertexPositionAttribute,4,g.FLOAT,!1,0,0),a.pushMatrix(),a.translate(e,t),a.scale(r,i),A(o),g.uniform4f(o.uColor,b.strokeStyle[0],b.strokeStyle[1],b.strokeStyle[2],b.strokeStyle[3]),g.drawArrays(g.LINE_LOOP,0,4),a.popMatrix()},g.clearRect=function(e,t,r,i){};var _=[];function a(e,t){this.closed=!1,this.verts=[e,t,0,0]}function o(e){var t=p.transform,r=p.initShaders(t.c_stack+2,0),i=_[e].verts;g.bindBuffer(g.ARRAY_BUFFER,g.pathVertexPositionBuffer),g.bufferData(g.ARRAY_BUFFER,new Float32Array(i),g.STATIC_DRAW),g.vertexAttribPointer(r.vertexPositionAttribute,4,g.FLOAT,!1,0,0),t.pushMatrix(),A(r);var a=b.fillStyle[0],o=b.fillStyle[1],n=b.fillStyle[2],f=b.fillStyle[3];g.uniform4f(r.uColor,a,o,n,f),g.drawArrays(g.TRIANGLE_FAN,0,i.length/4),t.popMatrix()}g.beginPath=function(){_.length=0},g.closePath=function(){if(_.length){var e=_[_.length-1],t=e.verts[0],r=e.verts[1];e.closed=!0;var i=new a(t,r);_.push(i)}},g.moveTo=function(e,t){_.push(new a(e,t))},g.lineTo=function(e,t){_.length?_[_.length-1].verts.push(e,t,0,0):g.moveTo(e,t)},g.quadraticApproximateCount=50,g.quadraticCurveTo=function(e,t,r,i){if(_.length)for(var a,o,n,f,s=_[_.length-1].verts,l=s[s.length-4],c=s[s.length-3],u=0;u<g.quadraticApproximateCount;u++)n=(o=1-(a=u/g.quadraticApproximateCount))*o*l+2*o*a*e+a*a*r,f=o*o*c+2*o*a*t+a*a*i,s.push(n,f,0,0);else g.moveTo(r,i)},g.bezierApproximateCount=50,g.bezierCurveTo=function(e,t,r,i,a,o){if(_.length)for(var n,f,s,l,c=_[_.length-1].verts,u=c[c.length-4],h=c[c.length-3],d=0;d<g.bezierApproximateCount;d++)s=(f=1-(n=d/g.bezierApproximateCount))*f*f*u+3*f*f*n*e+3*f*n*n*r+n*n*n*a,l=f*f*f*h+3*f*f*n*t+3*f*n*n*i+n*n*n*o,c.push(s,l,0,0);else g.moveTo(a,o)},g.arcTo=function(){_.length||g.moveTo(x,y)},g.rect=function(e,t,r,i){g.moveTo(e,t),g.lineTo(e+r,t),g.lineTo(e+r,t+i),g.lineTo(e,t+i),g.closePath()},g.arcApproximateCount=100,g.arc=function(e,t,r,i,a,o){var n=_[_.length-1].verts,f=e+r*w.cos(i),s=t+r*w.sin(i);for(n.push(f,s,0,0);i>2*w.PI;)i-=2*w.PI;for(;a>2*w.PI;)a-=2*w.PI;for(;i<2*-w.PI;)i+=2*w.PI;for(;a<2*-w.PI;)a+=2*w.PI;if(i!=a){var l,c=1/g.arcApproximateCount,u=g.arcApproximateCount;o&&(a-=2*w.PI,c=-c);for(var h=i;a<h&&o||h<a&&!o;h+=c)l!=(l=(h*u|0)/u)&&(f=e+r*w.cos(l),s=t+r*w.sin(l),n.push(f,s,0,0))}},g.fill=function(){for(var e=0;e<_.length;e++)o(e)},g.stroke=function(){for(var e=0;e<_.length;e++)t=e,r=void 0,r=p.transform,i=p.initShaders(r.c_stack+2,0),a=_[t],o=a.verts,g.bindBuffer(g.ARRAY_BUFFER,g.pathVertexPositionBuffer),g.bufferData(g.ARRAY_BUFFER,new Float32Array(o),g.STATIC_DRAW),g.vertexAttribPointer(i.vertexPositionAttribute,4,g.FLOAT,!1,0,0),r.pushMatrix(),A(i),g.uniform4f(i.uColor,b.strokeStyle[0],b.strokeStyle[1],b.strokeStyle[2],b.strokeStyle[3]),a.closed?g.drawArrays(g.LINE_LOOP,0,o.length/4):g.drawArrays(g.LINE_STRIP,0,o.length/4),r.popMatrix();var t,r,i,a,o},g.clip=function(){},g.isPointInPath=function(){},g.drawFocusRing=function(){};var n=[],f=[];function s(e){if(this.obj=g.createTexture(),this.index=f.push(this),n.push(e),e.width>p.maxTextureSize||e.height>p.maxTextureSize){var t=document.createElement("canvas");t.width=e.width>p.maxTextureSize?p.maxTextureSize:e.width,t.height=e.height>p.maxTextureSize?p.maxTextureSize:e.height,t.getContext("2d").drawImage(e,0,0,e.width,e.height,0,0,t.width,t.height),e=t}g.bindTexture(g.TEXTURE_2D,this.obj),g.texImage2D(g.TEXTURE_2D,0,g.RGBA,g.RGBA,g.UNSIGNED_BYTE,e),g.texParameteri(g.TEXTURE_2D,g.TEXTURE_WRAP_S,g.CLAMP_TO_EDGE),g.texParameteri(g.TEXTURE_2D,g.TEXTURE_WRAP_T,g.CLAMP_TO_EDGE),g.texParameteri(g.TEXTURE_2D,g.TEXTURE_MAG_FILTER,g.LINEAR),E(e.width)&&E(e.height)?(g.texParameteri(g.TEXTURE_2D,g.TEXTURE_MIN_FILTER,g.LINEAR_MIPMAP_LINEAR),g.generateMipmap(g.TEXTURE_2D)):g.texParameteri(g.TEXTURE_2D,g.TEXTURE_MIN_FILTER,g.LINEAR),g.bindTexture(g.TEXTURE_2D,null)}function P(e){var t=n.indexOf(e);return-1!==t?f[t]:new s(e)}g.drawImage=function(e,t,r,i,a,o,n,f,s){var l=p.transform;l.pushMatrix();var c=k,u=!1;3===arguments.length?(l.translate(t,r),l.scale(e.width,e.height)):5===arguments.length?(l.translate(t,r),l.scale(i,a)):9===arguments.length&&(l.translate(o,n),l.scale(f,s),c|=R,u=!0);var h=p.initShaders(l.c_stack,c),d=P(e);u&&g.uniform4f(h.uCropSource,t/e.width,r/e.height,i/e.width,a/e.height),g.bindBuffer(g.ARRAY_BUFFER,g.rectVertexPositionBuffer),g.vertexAttribPointer(h.vertexPositionAttribute,4,g.FLOAT,!1,0,0),g.bindTexture(g.TEXTURE_2D,d.obj),g.activeTexture(g.TEXTURE0),g.colorMask(1,1,1,1),g.uniform1i(h.uSampler,0),A(h),g.drawArrays(g.TRIANGLE_FAN,0,4),l.popMatrix()};var l=function(e,t){var r=P(e),i=["repeat","repeat-x","repeat-y","no-repeat"];t=String(t).toLowerCase(),~i.indexOf(t)||(t=i[0]),this.direction=t,this.texture=r,this.width=e.width,this.height=e.height};g.createPattern=function(e,t){return new l(e,t)},Object.defineProperty(g,"isWebGL",{configurable:!1,enumerable:!0,writable:!1,value:!0})}}(Math);